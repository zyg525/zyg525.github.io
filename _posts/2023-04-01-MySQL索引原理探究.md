---
title: MySQL索引原理探究
tags: MySQL 数据库
---

## 一、初识索引

　　这是数据库中的一张表t_student：

|  id  | name | age  |
| :--: | :--: | :--: |
|  1   | jack |  18  |
|  2   | tom  |  19  |
|  3   | rose |  20  |

　　现在有这样一条SQL语句：

```sql
select name,age from t_student where id = 2;
```

　　怎样才能提高这条SQL的查询效率呢？由于同一条记录的id、name、age是绑定在一起的，只要找到了id就能取到对应的name、age，因此重点在于id的查找。为了提高查找的效率，我们可以使用各种查找算法，比如二分法查找、二叉排序树查找、B树查找、B+树查找等等，这些查找算法都对应着特定的数据结构，例如二分法查找就要求元素有序。事实上，MySQL数据库就是通过B+树实现索引的，**因此，我们所说的给数据库字段加索引，意思就是按照某种数据结构重新排列字段元素，以便使用对应的查找算法，提高查询速度**。

## 二、索引的数据结构

　　现在以B+树为例，介绍一下索引的数据结构。

* ### B树与B+树

　　先复习几个概念：

　　1、二叉排序树：这种树的每个结点中只有一个元素，一个元素最多有左右两个子结点，并且左结点中的元素小于父结点元素，右结点中的元素大于父结点元素。

　　2、多路查找树：多路查找树类似于二叉排序树，不同的是每个结点中有多个元素。

　　3、B树：B树是一种平衡的多路查找树。

　　现在重点来了，什么是B+树？B+树和B树很像，都是一种平衡的多路查找树，它们的区别在于，当结点中的元素是key-value类型时，B树所有结点中的元素都是key-value类型，而B+树只有叶子结点中的元素是key-value类型，其余元素都是key类型。换一种角度形容就是，**B树中的数据均匀分布在每个结点上，而B+树中的数据只分布在叶子结点上，其它结点相当于存放着指向数据的指针**。

* ### 磁盘IO与预读

　　为什么MySQL使用B+树实现索引，而不是其它数据结构呢？这涉及到磁盘的IO操作。数据保存在磁盘上，但是由于读取磁盘是一个相当耗时的过程，所以我们可以将大量数据一次性读取到内存中(预读)，然后在内存中对数据进行操作，这样就避免了对磁盘频繁的读取。

　　很显然，二分法查找、二叉排序树这两种数据结构要求频繁地读取磁盘，但每次读取的数据量又很少，造成了资源的浪费。B树和B+树弥补了这个缺点，**并且B+树相比于B树，在每次读取的数据量大小相同的情况下，B+树读取磁盘的总次数更少**，原因是B+树的value只保存在叶子结点，非叶子结点中的空间被更多的key所占用，这样就降低了树的高度，从而减少了磁盘的读取次数。这就是MySQL使用B+树实现索引的原因。

　　B+树的查找过程如下图所示：

![B+树](/assets/img/java/B+树.png)

　　图中黄色代表磁盘块，绿色代表key，蓝色代表value，红色代表指针。当我们要查询key=15所对应的value时，过程如下：

　　1、将磁盘块1加载到内存，此时发生第一次IO；

　　2、在内存中通过二分法确定15在17左边，通过指针中的地址找到磁盘块2，将其加载到内存中，此时发生第二次IO；

　　3、在内存中通过二分法确定15在10右边，通过指针中的地址找到磁盘块7，将其加载到内存中，此时发生第二次IO；

　　4、在内存中通过二分法找到15对应的value是tom。
