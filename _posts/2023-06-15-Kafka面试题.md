---
title: Kafka面试题
tags: Java面试
---

* ### 1、介绍一下Kafka的架构

　　Kafka包括**生产者、Topic、消费者**三个部分，其中生产者负责向Topic中写入消息，消费者负责从Topic中获取消息。

　　Topic中可以有多个**分区**，生产者写入消息时可以指定一个key，key相同的消息会被写入到同一个分区，如果不指定key，消息会以轮询的方式发送到各个分区中。每个分区只能有一个消费者，一个消费者可以消费多个分区，分区内的消息是有序的。每个分区都会记录一个**offset**，它代表了当前分区消费到的位置，这样当消费者切换分区时，就不需要重复消费了。多个消费者可以组成一个**消费者组**，组内的消费者不能重复消费，但消费者组间是互不影响的，可以重复消费。

* ### 2、Kafka默认保留几天数据？

　　7天。

* ### 3、Kafka如何保证顺序消费？

　　生产者发送消息时指定相同的key，将消息发送到同一个分区，消费者消费这一个分区。

* ### 4、Java中怎样生产和消费数据？

　　1、通过`KafkaTemplate`的`send(String topic, V data)`方法发送消息到Topic；

　　2、根据分区数量，创建多个线程，在每个线程内部创建消费者对象，即`KafkaConsumer`对象，然后在`while`循环中调用它的`poll()`方法，不断从Topic中批量拉取数据进行消费。

* ### 5、如何解决重复消费问题？

　　业务逻辑做了幂等设计，对于重复消费的数据，会和数据库中已经存在的数据进行比对，即使多次重复消费，也不会影响最终的结果。