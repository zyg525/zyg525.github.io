---
title: Java语言基础之正则表达式
categories: 三、Java语言基础
tags: Java语言基础
layout: post
---



## 概述

　　一个正则表达式就是一个描述规则的字符串，所以，只需要编写正确的规则，我们就可以让正则表达式引擎去判断目标字符串是否符合规则。正则表达式是一套标准，它可以用于任何语言。Java标准库的`java.util.regex`包内置了正则表达式引擎，在Java程序中使用正则表达式非常简单。

　　举个例子：要判断用户输入的年份是否是`20##`年，代码可以这样写：

```java
String year = "2024";
String regex = "20\\d\\d";
System.out.println(year.matches(regex)); //true
```

　　或者这样写：

```java
Pattern p = Pattern.compile("20\\d\\d");
Matcher m = p.matcher("2024");
System.out.println(m.matches()); //true
```

　　**在正则表达式中，`\d`表示任意一个`0-9`之间的数字，而在Java中转义字符`\`要写成`\\`，所以要用`\\d`来表示。**

## 简单匹配规则

　　正则表达式的匹配规则是从左到右按规则匹配。简单的匹配规则如下：

### 单个字符匹配规则

| 正则表达式     | 匹配规则                                                     | 例子                                     |
| -------------- | ------------------------------------------------------------ | ---------------------------------------- |
| `.`            | 可以匹配任意一个字符                                         | 表达式`a..c`可以匹配字符串`a1bc`         |
| `\d`           | 可以匹配`0-9`之间的任意一个数字                              | 表达式`20\d\d`可以匹配字符串`2024`       |
| `\D`           | 和`\d`相反                                                   |                                          |
| `\w`           | 可以匹配任意一个字母，或者`0-9`之间的任意一个数字，或者一个下划线`_` | 表达式`a\w\w\wc`可以匹配字符串`a5_sc`    |
| `\W`           | 和`\w`相反                                                   |                                          |
| `\s`           | 可以匹配任意一个空白符，空白符包括空格` `、 制表符`\t`、换行符`\n`、回车符`\r`、换页符`\f` | 表达式`a\sc`可以匹配字符串`a c`          |
| `\S`           | 和`\s`相反                                                   |                                          |
| `\u559d`       | 可以匹配任意一个Unicode字符                                  | 表达式`a\u559d`可以匹配字符串`a喝c`      |
| `[123abcABC]`  | 可以匹配`123abcABC`中的任意一个字符                          | 表达式`a[123abcABC]c`可以匹配字符串`a3c` |
| `[1-3a-cA-C]`  | 和`[123abcABC]`的规则一样，是一种简化写法                    |                                          |
| `[^1-3a-cA-C]` | 和`[1-3a-cA-C]`相反                                          |                                          |

### 重复匹配规则

| 正则表达式 | 匹配规则                        | 例子                                      |
| ---------- | ------------------------------- | ----------------------------------------- |
| `*`        | 可以匹配任意个字符，包括0个字符 | 表达式`a\d*c`可以匹配字符串`a12345c`      |
| `+`        | 可以匹配大于0的任意个字符       | 表达式`a\d+c`可以匹配字符串`a12345c`      |
| `?`        | 可以匹配0个或者1个字符          | 表达式`a\d?c`可以匹配字符串`a1c`          |
| `{n}`      | 可以精确匹配n个字符             | 表达式`a\d{5}c`可以匹配字符串`a12345c`    |
| `{n, m}`   | 可以匹配n-m个字符               | 表达式`a\d{5,6}c`可以匹配字符串`a123456c` |
| `{n,}`     | 可以匹配大于等于n的任意个字符   | 表达式`a\d{5,}c`可以匹配字符串`a1234567c` |

### 其它匹配规则

| 正则表达式 | 匹配规则   | 例子                                                 |
| ---------- | ---------- | ---------------------------------------------------- |
| `|`        | 或规则匹配 | 表达式`hello|world`可以匹配字符串`world`             |
| `()`       | 分组匹配   | 表达式`Java (hello|world)`可以匹配字符串`Java world` |

## 分组匹配

　　使用分组匹配可以从字符串中提取出符合规则的子串。比如对于`区号-电话号`这个格式，它的正则表达式是`\d{3,4}-\d{6,8}`，如果要提取出`010-12345678`中的区号和电话号，就要先把正则表达式分组，然后使用`java.util.regex`中的工具类进行提取：

```java
Pattern p = Pattern.compile("(\\d{3,4})-(\\d{7,8})");
Matcher m = p.matcher("010-12345678");
// 使用Matcher时，必须首先调用matches()判断是否匹配成功，匹配成功后，才能调用group()提取子串
if(m.matches()) {
    String s1 = m.group(1);
    String s2 = m.group(2);
    System.out.println("s1="+s1+"\n"+"s2="+s2);
}

打印结果：
s1=010
s2=12345678
```

## 贪婪匹配和非贪婪匹配

　　正则表达式默认使用**贪婪匹配：任何一个规则，它总是尽可能多地向后匹配**。比如对于正则表达式`(\d+)(0*)`，如果用它去提取`123000`，我们希望提取出的两个子串分别是`123`和`000`，但实际上提取出的是`123000`和` `，因为`123000`完全符合`\d+`的要求。如果要实现我们的目标，就要**使用非贪婪匹配`?`，表示要尽可能少地向后匹配**，此时正则表达式应改为`(\d+?)(0*)`：

```java
Pattern p = Pattern.compile("(\\d+?)(0*)");
Matcher m = p.matcher("123000");
if(m.matches()) {
    String s1 = m.group(1);
    String s2 = m.group(2);
    System.out.println("s1="+s1+"\n"+"s2="+s2);
}

打印结果：
s1=123
s2=000
```

## 其它用法

### 分割字符串

　　可以使用正则表达式分割字符串：

```java
String s = "1, 2,   3      4、5";
String[] res = s.split("[, 、]+"); // res = {1,2,3,4,5}
```

### 搜索字符串

　　可以使用正则表达式搜索字符串：

```java
String s = "the quick brown fox jumps over the lazy dog.";
Pattern p = Pattern.compile("\\wo\\w");
Matcher m = p.matcher(s);
// 不能使用matches()方法，因为是全局匹配，而find()是局部匹配
while (m.find()) {
    String sub = s.substring(m.start(), m.end());
    System.out.println(sub);
}

打印结果：
row
fox
dog
```

### 替换字符串

　　可以使用正则表达式替换字符串：

```java
String s = "1,2 3、4-5";
String res = s.replaceAll("[, 、-]", "+"); // res = "1+2+3+4+5"
```

　　如果我们要把搜索到的指定字符串按规则替换，使用`replaceAll()`的时候，我们传入的第二个参数可以使用`$1`、`$2`来反向引用匹配到的子串。例如：

```java
String s = "1aA2bB3cC";
String res = s.replaceAll("([1-3])([a-c])([A-C])", "[$1]($2)<$3>"); // res = [1](a)<A>[2](b)<B>[3](c)<C>
```

