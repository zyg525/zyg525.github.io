---
title: Java时间与日期
tags: Java基础
---

## 一、时间与日期的基本概念

　　1、**本地时间**：本地时间指的是当前所在位置的时间，在同一时刻，不同时区的本地时间是不同的。

　　2、**时区**：全球一共划分为24个时区，伦敦所在时区为0时区，伦敦以东的地区时区增加，以西的地区时区减少，比如北京所在的时区是东八区，纽约所在时区为西五区。

　　3、**GMT**：即格林威治标准时间。还有一个UTC，表示协调时间时间，GMT和UTC可以认为是等价的，只不过UTC使用更精确的原子钟计时。时区可以用GMT或UTC来表示，比如东八区就可以表示为`GMT+08:00`或`UTC+08:00`。

　　4、**CST**：中国标准时间，即东八区标准时间。中国标准时间还可以用`Asia/Shanghai`表示。

　　5、**夏令时**：所谓夏令时，就是夏天开始的时候，把时间往后拨1小时，夏天结束的时候，再把时间往前拨1小时。我们国家实行过一段时间夏令时，1992年就废除了，但是矫情的美国人到现在还在使用，所以时间换算更加复杂。比如`2023-06-20 19:00:00`，如果以`GMT`或者`UTC`作为时区，时间是`19:00`，如果以国家／城市表示，例如`America／NewYork`，因为夏令时的存在，时间是`20:00`。

## 二、Date和Calendar

* ### Date

　　在计算机中，时间是用一个整数存储的，叫做时间戳，它表示从1970年1月1日零点到现在所经历的毫秒数。在Java中获取当前时间戳的方式是：

```java
long timeStamp = System.currentTimeMillis();
```

　　`java.util.Date`是用于表示一个日期和时间的对象，注意与`java.sql.Date`区分，后者用在数据库中。如果观察Date的源码，可以发现它实际上存储了一个long类型的以毫秒表示的时间戳。



　　**Date的基本用法**

```java
Date date = new Date(); //获取本地时间
int year = date.getYear(); //获取年份，需要加1900
int month = date.getMonth(); //获取月份，范围0-11，需要加1
int dayOfMonth = date.getDate(); //获取月份中的日，范围1-31
int hours = date.getHours(); //获取小时
int minutes = date.getMinutes(); //获取分钟
int seconds = date.getSeconds(); //获取秒
String s = date.toGMTString(); //将本地时间转换为格林威治标准时间
```

　　

　　**SimpleDateFormat格式转换**

```java
SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
String format = sdf.format(date); //按照指定格式输出Date为字符串，2023-05-02 10:31:48
Date newDate = sdf.parse("2023-05-02 11:10:30"); //按照指定格式解析字符串为Date
```

　　

　　`Date`对象有几个严重的问题：它不能转换时区，除了`toGMTString()`可以按`GMT+0:00`输出外，Date总是以当前计算机系统的默认时区为基础进行输出。此外，我们也很难对日期和时间进行加减，计算两个日期相差多少天，计算某个月第一个星期一的日期等。

* ### Calendar

　　`Calendar`可以用于获取并设置年、月、日、时、分、秒，它和`Date`比，主要多了一个可以做简单的日期和时间运算的功能。

　　

　　**Calendar的基本用法**

```java
Calendar c = Calendar.getInstance(); //获取本地时间
int year = c.get(Calendar.YEAR); //获取年份
int month = c.get(Calendar.MONTH); //获取月份，范围0-11，需要加1
int dayOfMonth = c.get(Calendar.DAY_OF_MONTH); //获取月份中的日，范围1-31
int dayOfWeek = c.get(Calendar.DAY_OF_WEEK); //获取星期，范围1-7，分别表示周日到周六
int hour = c.get(Calendar.HOUR); //获取小时
int minute = c.get(Calendar.MINUTE); //获取分钟
int second = c.get(Calendar.SECOND); //获取秒
Date date = c.getTime(); //将Calendar对象转换为Date对象
```

　　`Calendar`也可以对日期和时间进行简单的加减：

```java
Calendar c = Calendar.getInstance();
//加5天并减去2小时
c.add(Calendar.DAY_OF_MONTH, 5);
c.add(Calendar.HOUR_OF_DAY, -2);
```

　　

　　**TimeZone**

　　`Calendar`和`Date`相比，它提供了时区转换的功能。时区用`TimeZone`对象表示，`TimeZone`的常用方法有：

```java
TimeZone tzDefault = TimeZone.getDefault(); // 当前时区
TimeZone tzGMT9 = TimeZone.getTimeZone("GMT+09:00"); // GMT+9:00时区
TimeZone tzNY = TimeZone.getTimeZone("America/New_York"); // 纽约时区
String[] availableIDs = TimeZone.getAvailableIDs(); //获取所有有效的时区ID
```

　　有了时区，我们就可以对指定时间进行转换：

```java
TimeZone tzDefault = TimeZone.getDefault(); // 当前时区
TimeZone tzGMT9 = TimeZone.getTimeZone("GMT+09:00"); // GMT+9:00时区

Calendar c = Calendar.getInstance();
c.clear(); //清除Calendar对象中的所有字段
c.set(2023,5,2,10,51,30); //自定义时间
c.setTimeZone(tzDefault); //设置时区为当前时区

SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss"); //设置要转换的时间格式
sdf.setTimeZone(tzGMT9); //设置要转换的时区为东九区

System.out.println(sdf.format(c.getTime())); //转换时间格式和时区
```

## 二、LocalDateTime

　　从Java 8开始，`java.time`包提供了新的日期和时间API，主要涉及的类型有：

　　1、本地日期和时间：`LocalDateTime`，`LocalDate`，`LocalTime`；

　　2、带时区的日期和时间：`ZonedDateTime`；

　　3、时刻：`Instant`；

　　4、时区：`ZoneId`，`ZoneOffset`；

　　5、时间间隔：`Duration`。

* ### LocalDateTime、LocalDate、LocalTime

　　`LocalDateTime`代表本地日期和时间，`LocalDate代`表本地日期，`LocalTime`代表本地时间。

　　**获取本地时间和日期**的方法如下：

```java
LocalDateTime localDateTime = LocalDateTime.now(); //获取本地日期和时间，2023-05-02T11:19:24.866
LocalDate localDate = localDateTime.toLocalDate(); //获取本地日期，2023-05-02
LocalTime localTime = localDateTime.toLocalTime(); //获取本地时间，11:19:24.866
```

　　**创建指定日期和时间**的方法如下：

```java
LocalDateTime localDateTime = LocalDateTime.of(2023, 5, 2, 11, 24, 30);
LocalDate localDate = LocalDate.of(2023, 5, 2);
LocalTime localTime = LocalTime.of(11, 24, 30);
```

　　本地日期和时间通过now()获取到的总是以当前默认时区返回的，和旧API不同，`LocalDateTime`、`LocalDate`和`LocalTime`默认严格按照[ISO 8601](https://www.iso.org/iso-8601-date-and-time-format.html)规定的日期和时间格式进行打印(即以`T`为日期和时间的分隔符)。

　　

　　**DateTimeFormatter格式转换**

```java
LocalDateTime localDateTime = LocalDateTime.now();
DateTimeFormatter dtf = DateTimeFormatter.ofPattern("yyyy-MM-dd HH:mm:ss");
String format = dtf.format(localDateTime); //按照指定格式输出LocalDateTime为字符串
LocalDateTime parse = LocalDateTime.parse("2023-05-02 11:30:30", dtf); //按照指定格式解析字符串为LocalDateTime
```

　　`DateTimeFormatter`是线程安全的，而`SimpleDateFormat`是线程不安全的。

　　

　　**对时间和日期进行修改**

```java
LocalDateTime localDateTime = LocalDateTime.now();
LocalDateTime newLocalDateTime1 = localDateTime.plusDays(1).minusHours(2); //加1天减2小时
LocalDateTime newLocalDateTime2 = localDateTime.withDayOfMonth(15); //修改日期为15号
```

　　修改月份时，会自动修改日期，不会出现不合法的日期，比如将5月31日的月份修改为4月时，日期会自动修改为30号，因为4月没有31号。

　　

　　**判断日期前后**

　　要判断两个`LocalDateTime`的先后，可以使用`isBefore()`、`isAfter()`方法：

```java
LocalDateTime t1 = LocalDateTime.now();
Thread.sleep(1000);
LocalDateTime t2 = LocalDateTime.now();
boolean before = t1.isBefore(t2); //true
```

　　

　　**计算时间与日期间隔**

　　时间间隔：

```java
LocalDateTime localDateTime1 = LocalDateTime.of(2023, 5, 2, 11, 24, 30);
LocalDateTime localDateTime2 = LocalDateTime.of(2023, 4, 2, 10, 24, 50);
Duration duration = Duration.between(localDateTime1, localDateTime2);
System.out.println(duration); //PT-720H-59M-40S
```

　　日期间隔：

```java
LocalDate localDate1 = LocalDate.of(2023, 5, 2);
LocalDate localDate2 = LocalDate.of(2024, 6, 1);
Period period = Period.between(localDate1, localDate2);
System.out.println(period); //P1Y30D
```

* ### ZonedDateTime

　　`LocalDateTime`总是表示本地日期和时间，要表示一个带时区的日期和时间，我们就需要`ZonedDateTime`。可以简单地把`ZonedDateTime`理解成`LocalDateTime`加`ZoneId`。

　　

　　**获取带时区的当前时间**

```java
ZonedDateTime now1 = ZonedDateTime.now(); //默认时区的时间
ZonedDateTime now2 = ZonedDateTime.now(ZoneId.of("America/New_York")); //纽约时区的时间
System.out.println(now1); //2023-05-02T11:58:56.694+08:00[Asia/Shanghai]
System.out.println(now2); //2023-05-01T23:58:56.653-04:00[America/New_York]
```

　　

　　**LocalDateTime和ZonedDateTime的转换**

　　给一个`LocalDateTime`附加一个`ZoneId`，就可以变成`ZonedDateTime`：

```java
LocalDateTime localDateTime = LocalDateTime.now();
ZonedDateTime zonedDateTime = localDateTime.atZone(ZoneId.of("America/New_York"));
```

　　`ZonedDateTime`转换为`LocalDateTime`时，只是去掉了`ZoneId`：

```java
ZonedDateTime zonedDateTime = ZonedDateTime.now();
LocalDateTime localDateTime = zonedDateTime.toLocalDateTime();
```

　　

　　**时区转换**

```java
ZonedDateTime zonedDateTime1 = ZonedDateTime.now(ZoneId.of("Asia/Shanghai"));
ZonedDateTime zonedDateTime2 = zbj.withZoneSameInstant(ZoneId.of("America/New_York"));
System.out.println(zonedDateTime1); //2023-05-02T12:04:02.477+08:00[Asia/Shanghai]
System.out.println(zonedDateTime2); //2023-05-02T00:04:02.477-04:00[America/New_York]
```

* ### Instant

　　Java提供的`System.currentTimeMillis()`返回的就是以毫秒表示的当前时间戳。这个当前时间戳在`java.time`中以`Instant`类型表示，我们用`Instant.now()`获取当前时间戳，效果和`System.currentTimeMillis()`类似：

```java
Instant now = Instant.now();
long l1 = now.getEpochSecond(); //秒
long l2 = now.toEpochMilli(); //毫秒
```

　　使用`Instant`和`ZoneId`可以构造出`ZonedDateTime`：

```java
Instant instant = Instant.ofEpochMilli(1683002060373L);
ZonedDateTime zonedDateTime = instant.atZone(ZoneId.of("America/New_York"));
```

　　所以，`LocalDateTime`，`ZoneId`，`Instant`，`ZonedDateTime`和`long`都可以互相转换：

```ascii
┌─────────────┐
│LocalDateTime│────┐
└─────────────┘    │    ┌─────────────┐
                   ├───>│ZonedDateTime│
┌─────────────┐    │    └─────────────┘
│   ZoneId    │────┘           ▲
└─────────────┘      ┌─────────┴─────────┐
                     │                   │
                     ▼                   ▼
              ┌─────────────┐     ┌─────────────┐
              │   Instant   │<───>│    long     │
              └─────────────┘     └─────────────┘
```

## 四、新旧API转换

　　由于Java提供了新旧两套日期和时间的API，除非涉及到遗留代码，否则我们应该坚持使用新的API。如果需要与遗留代码打交道，如何在新旧API之间互相转换呢？

* ### 旧API转新API

　　如果要把旧式的`Date`或`Calendar`转换为新API对象，可以通过`toInstant()`方法转换为`Instant`对象，再继续转换为`ZonedDateTime`：

```java
// Date -> Instant:
Instant ins1 = new Date().toInstant();

// Calendar -> Instant -> ZonedDateTime:
Calendar calendar = Calendar.getInstance();
Instant ins2 = calendar.toInstant();
ZonedDateTime zdt = ins2.atZone(calendar.getTimeZone().toZoneId());
```

　　从上面的代码还可以看到，旧的`TimeZone`提供了一个`toZoneId()`，可以把自己变成新的`ZoneId`。

* ### 新API转旧API

　　如果要把新的`ZonedDateTime`转换为旧的API对象，只能借助`long`型时间戳做一个“中转”：

```java
// ZonedDateTime -> long:
ZonedDateTime zdt = ZonedDateTime.now();
long ts = zdt.toEpochSecond() * 1000;

// long -> Date:
Date date = new Date(ts);

// long -> Calendar:
Calendar calendar = Calendar.getInstance();
calendar.clear();
calendar.setTimeZone(TimeZone.getTimeZone(zdt.getZone().getId()));
calendar.setTimeInMillis(zdt.toEpochSecond() * 1000);
```

　　从上面的代码还可以看到，新的`ZoneId`转换为旧的`TimeZone`，需要借助`ZoneId.getId()`返回的`String`完成。

　　

本文参考：

1、[廖雪峰的官方网站-日期与时间](https://www.liaoxuefeng.com/wiki/1252599548343744/1303905346519074)