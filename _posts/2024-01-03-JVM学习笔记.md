---
title: JVM学习笔记
categories: JVM
layout: post
---



## 前端编译与优化

**前端编译与优化的作用：**

前端编译的作用是把Java文件编译成class文件，优化的作用是提高程序员的编码效率。

　

**前端编译过程：**

1、准备过程：初始化插入式注解处理器；

2、解析与填充符号表过程：词法语法分析，填充符号表；

3、插入式注解处理器的注解处理过程：插入式注解处理器的执行阶段；

4、分析与字节码生成过程：标注检查，数据流及控制流分析，解语法糖，字节码生成。

## 后端编译与优化

**后端编译与优化的作用：**

后端编译的作用是把class文件翻译成本地机器码，优化的作用是让生成的机器码执行效率更高。

　

**解释器和即时编译器**

　　JVM通过**解释器**执行代码，当某段代码执行频率很高时，在运行时JVM会把这部分代码通过**即时编译器**翻译成本地机器码，并进行优化。解释器的特点是启动快、执行过程慢，即时编译器的特点是编译过程慢，但是执行机器码的速度很快，编译的过程比较消耗内存。一般两者一起工作，当程序启动后解释器首先发挥作用，随着时间推移，即时编译器逐渐发挥作用，把越来越多的代码翻译成本地机器码。

　

**客户端编译器和服务端编译器**

　　HotSpot虚拟机中内置了两个即时编译器，分别称为客户端编译器和服务端编译器，或者称为C1编译器和C2编译器，二者搭配使用的方式叫做“混合模式(Mixed Mode)”。C2编译器比C1编译器的编译过程更加复杂、更加激进。

　

**编译对象与触发条件**

　　即时编译器会将热点代码编译成机器码，热点代码分为两类：被多次调用的方法和被多次执行的循环体。

　　判断热点代码的方法叫做”热点探测“，主流的探测方法有：基于采样的热点探测和基于计数器的热点探测。

　

**提前编译器**

　　提前编译是指在代码运行之前就编译成机器码。

　

**编译优化技术**

　　编译优化的作用是让生成的机器码执行效率更高。常见的编译优化技术有：

　　1、**方法内联**：将目标方法中的代码复制到发起调用的方法内，避免发生真实的方法调用。

　　2、**逃逸分析**：一个对象在作用域内(可能是方法，也可能是线程)被定义，但是可能会被其它作用域访问到，称为逃逸。根据对象不同的逃逸程度，可以采取不同的优化方式。

　　　　常见的优化方式有：

　　　　**栈上分配**：堆内存线程共享，栈内存线程独立，如果一个对象不会逃逸出线程，那么可以给它在栈上分配内存，从而大大减轻垃圾收集系统的压力。

　　　　**标量替换**：如果一个对象不会被外部访问，那么在运行时可能不会创建这个对象，而是创建它的成员变量，即将对象拆分。

　　　　**同步消除**：如果一个变量不会逃逸出线程，那么对它的同步措施就可以消除掉。

　　　　**公共子表达式消除**：如果一个表达式在之前已经被计算过了，并且表达式中的所有变量值都没有修改过，那么对于这种表达式不需要再计算，只需要用前面的计算结果代替该表达式。

　　　　**数组边界检查**：为了避免数组越界，在运行期会对数组进行边界检查，频繁的检查很消耗性能，因此可以在后端编译时，根据条件来取消边界检查，比如数组在循环体中被访问，并且判断出循环变量的取值范围不超过数组长度，即不会出现数组越界，此时就可以取消边界检查。

　　　　