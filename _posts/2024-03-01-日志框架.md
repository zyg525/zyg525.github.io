---
title: 数据库之日志框架
categories: 八、第三方组件
tags: 第三方组件
layout: post
---



## 一、日志框架简介

### 日志框架的作用

　　使用日志框架，而不是用`System.out.println()`，有以下几个好处：

　　1、**可以设置输出样式**，避免自己每次都写`"ERROR: " + var`；

　　2、**可以设置输出级别**，禁止某些级别输出。例如，只输出错误日志；

　　3、**可以被重定向到文件**，这样可以在程序运行结束后查看日志；

　　4、**可以按包名控制日志级别**，只输出某些包打的日志；

　　5、......

### JDK Logging

　　Java标准库内置了日志包`java.util.logging`，可以直接使用：

```java
public static void main(String[] args) {
    Logger logger = Logger.getGlobal();
    logger.info("info");
    logger.warning("warning");
    logger.fine("fine");
    logger.severe("severe");
}
```

　　使用Java标准库内置的Logging有以下局限：Logging系统在JVM启动时读取配置文件并完成初始化，一旦开始运行main()方法，就无法修改配置；配置不太方便，需要在JVM启动时传递参数`-Djava.util.logging.config.file=`。因此，Java标准库内置的Logging使用并不是非常广泛。

### Commons Logging

　　Commons Logging是一个第三方日志库，它是由Apache创建的日志模块。**Commons Logging的特色是，它没有日志功能，但可以挂接不同的日志系统，因此Commons Logging只能作为日志API使用**。

　　Commons Logging的依赖是：

```xml
<dependency>
  <groupId>commons-logging</groupId>
  <artifactId>commons-logging</artifactId>
  <version>1.2</version>
</dependency>
```

　　Commons Logging的使用方法是：

```java
public class LogMain {
    
    static final Log log = LogFactory.getLog(LogMain.class);
    // 如果想在实例方法中使用日志，可以通过getClass()方法获取class实例，这样子类也可以使用日志而不需要修改代码
    protected final Log log1 = LogFactory.getLog(getClass());
    
    public static void main(String[] args) {
        log.trace("trace");
        log.debug("debug");
        log.info("info");
        log.warn("warn");
        log.error("error");
        log.fatal("fatal");
    }
}
```

　　Commons Logging还为每个打印日志的方法提供了非常有用的重载方法：`info(String, Throwable)、warn(String, Throwable)`等，这使得记录异常更加简单：

```java
try {
    int a = 1/0;
}catch (Exception e) {
    log.info("抛出异常: "+e);
}
```

### Log4j

　　log4j是apache旗下的项目，apache已经在2015年8月5日宣布log4j 1.x的版本已经不再更新了，最终版本是log4j 1.2.17的版本。**log4j是一种日志实现框架，它可以挂接到日志API框架上，比如Commons Logging。**

　　log4j的依赖是：

```xml
<dependency>
    <groupId>log4j</groupId>
    <artifactId>log4j</artifactId>
    <version>1.2.17</version>
</dependency>
```

### Log4j2

　　apache官方已经声明log4j1.x不再更新，建议开发者使用log4j2，它相比1.x在使用上发生了较大的变化。**Log4j2也是一种日志实现框架，可以挂接到日志API框架上。**

　　log4j2的依赖是：

```xml
<dependency>
    <groupId>org.apache.logging.log4j</groupId>
    <artifactId>log4j-core</artifactId>
    <version>2.14.1</version>
</dependency>
<dependency>
    <groupId>org.apache.logging.log4j</groupId>
    <artifactId>log4j-jcl</artifactId>
    <version>2.14.1</version>
</dependency>
```

### SLF4J

　　**SLF4J类似于Commons Logging，也是一个日志API框架，没有日志功能，只能挂载其它日志实现框架**。

　　SLF4J的依赖是：

```xml
<dependency>
    <groupId>org.slf4j</groupId>
    <artifactId>slf4j-api</artifactId>
    <version>1.7.12</version>
</dependency>
```

　　SLF4J的使用方法是(和Commons Logging很像)：

```java
public class LogMain {
    // 静态字段
	static final Logger logger = LoggerFactory.getLogger(LogMain.class);
    // 实例字段
	protected final Logger logger1 = LoggerFactory.getLogger(getClass());
    
    public static void main(String[] args) {
        logger.trace("trace");
        logger.debug("debug");
        logger.info("info");
        logger.warn("warn");
        logger.error("error");
    }
}
```

### Logback

　　Logback是一种日志实现框架，SLF4j和Logback的作者是同一个人，所以说Logback是原生地实现了SLF4j。

　　Logback的依赖是：

```xml
<dependency>
    <groupId>ch.qos.logback</groupId>
    <artifactId>logback-core</artifactId>
    <version>1.1.3</version>
</dependency>
<dependency>
    <groupId>ch.qos.logback</groupId>
    <artifactId>logback-classic</artifactId>
    <version>1.1.3</version>
</dependency>
```

## 二、日志框架集成

### 概述

　　日志API框架必须和日志实现框架配合使用才能生效，日志API框架包括**Commons Logging、SLF4J**，日志实现框架包括**Log4j、Log4j2、Logback**。

### Commons Logging集成其它日志框架

* #### 集成Log4j

　　1、添加依赖

```xml
<!-- Commons Logging依赖 -->
<dependency>
    <groupId>commons-logging</groupId>
    <artifactId>commons-logging</artifactId>
    <version>1.2</version>
</dependency>
<!-- Log4j依赖 -->
<dependency>
    <groupId>log4j</groupId>
    <artifactId>log4j</artifactId>
    <version>1.2.17</version>
</dependency>
```

　　2、在类路径下创建配置文件`log4j.properties`

```properties
#根Logger，表示只输出info及更高级别的日志，使用的附加器是console和file。info换成off表示关闭日志功能，换成all表示输出所有等级的日志
log4j.rootLogger=debug,console,file

#日志附加器，负责控制日志的输出位置、输出布局、文件大小等
#自定义控制台附加器console，表示日志输出到控制台
log4j.appender.console = org.apache.log4j.ConsoleAppender
#Target属性：控制输出到控制台的使用目标，其值为 System.out 或 System.err，前者黑色字体，后者红色字体
log4j.appender.console.Target = System.out
#layout.ConversionPattern属性：控制输出布局
log4j.appender.console.layout = org.apache.log4j.PatternLayout
log4j.appender.console.layout.ConversionPattern= [%-5p][%d{yyyy-MM-dd HH:mm:ss}]%m%n

#自定义文件附加器file，表示日志输出到文件
log4j.appender.file = org.apache.log4j.FileAppender
log4j.appender.file.File = D:/Java/WorkSpace/myLogs/mylog1.log
log4j.appender.file.layout = org.apache.log4j.PatternLayout
log4j.appender.file.layout.ConversionPattern= [%-5p][%d{yyyy-MM-dd HH:mm:ss}]%m%n

#自定义滚动文件附加器rollFile，表示当日志文件大小到达指定尺寸时将产生一个新的日志文件
log4j.appender.rollFile = org.apache.log4j.RollingFileAppender
log4j.appender.rollFile.File = D:/Java/WorkSpace/myLogs/mylog2.log
log4j.appender.rollFile.MaxFileSize = 10KB
log4j.appender.rollFile.layout = org.apache.log4j.PatternLayout
log4j.appender.rollFile.layout.ConversionPattern= [%-5p][%d{yyyy-MM-dd HH:mm:ss}]%m%n
```

　　3、调用Commons Logging的日志方法即可。

* #### 集成Log4j2

　　1、添加依赖

```xml
<!-- Commons Logging依赖 -->
<dependency>
    <groupId>commons-logging</groupId>
    <artifactId>commons-logging</artifactId>
    <version>1.2</version>
</dependency>
<!-- Log4j2依赖 -->
<dependency>
    <groupId>org.apache.logging.log4j</groupId>
    <artifactId>log4j-core</artifactId>
    <version>2.14.1</version>
</dependency>
<dependency>
    <groupId>org.apache.logging.log4j</groupId>
    <artifactId>log4j-jcl</artifactId>
    <version>2.14.1</version>
</dependency>
```

　　2、在类路径下创建配置文件`log4j2.xml`

```xml
<?xml version="1.0" encoding="UTF-8"?>

<!--status属性用于设置log4j2自身运行的日志配置，一般为OFF-->
<Configuration status="OFF">
    <!--附加器元素-->
    <Appenders>
        <Console name="console" target="SYSTEM_OUT">
            <PatternLayout pattern="%d{HH:mm:ss.SSS} [%t] %-5level %logger{36} - %msg%n" />
        </Console>

        <!--fileName="log/output.log"表示日志将在项目根目录下的log/output.log文件中输出。
        append 属性用于设置是否以追加方式将日志写入文件中。-->
        <File name="file" fileName="log/output.log" append="true">
            <PatternLayout pattern="%d{HH:mm:ss.SSS} [%t] %-5level %logger{36} - %msg%n" />
        </File>

        <!--filePattern 指定新创建的日志文件的文件名-->
        <RollingFile name="rollingFile" fileName="logs/app.log"
                     filePattern="logs/$${date:yyyy-MM}/app-%d{MM-dd-yyyy}-%i.log.gz">
            <PatternLayout pattern="%d{HH:mm:ss.SSS} [%t] %-5level %logger{36} - %msg%n" />
            <SizeBasedTriggeringPolicy size="1kb" />
        </RollingFile>
    </Appenders>

    <Loggers>
        <Root level="info">
            <AppenderRef ref="console" />
            <AppenderRef ref="rollingFile" />
        </Root>
    </Loggers>

</Configuration>
```

　　3、调用Commons Logging的日志方法即可。

### SLF4J集成其它日志框架

* #### 集成Log4j

　　1、添加依赖

```xml
<!-- slf4j依赖 -->
<dependency>
    <groupId>org.slf4j</groupId>
    <artifactId>slf4j-api</artifactId>
    <version>1.7.12</version>
</dependency>
<!-- slf4j和log4j的适配器依赖 -->
<dependency>
    <groupId>org.slf4j</groupId>
    <artifactId>slf4j-log4j12</artifactId>
    <version>1.7.12</version>
</dependency>
<!-- log4j依赖 -->
<dependency>
    <groupId>log4j</groupId>
    <artifactId>log4j</artifactId>
    <version>1.2.17</version>
</dependency>
```

　　2、在类路径下创建配置文件`log4j.properties`

```properties
#根Logger，表示只输出info及更高级别的日志，使用的附加器是console和file。info换成off表示关闭日志功能，换成all表示输出所有等级的日志
log4j.rootLogger=debug,console,file

#日志附加器，负责控制日志的输出位置、输出布局、文件大小等
#自定义控制台附加器console，表示日志输出到控制台
log4j.appender.console = org.apache.log4j.ConsoleAppender
#Target属性：控制输出到控制台的使用目标，其值为 System.out 或 System.err，前者黑色字体，后者红色字体
log4j.appender.console.Target = System.out
#layout.ConversionPattern属性：控制输出布局
log4j.appender.console.layout = org.apache.log4j.PatternLayout
log4j.appender.console.layout.ConversionPattern= [%-5p][%d{yyyy-MM-dd HH:mm:ss}]%m%n

#自定义文件附加器file，表示日志输出到文件
log4j.appender.file = org.apache.log4j.FileAppender
log4j.appender.file.File = D:/Java/WorkSpace/myLogs/mylog1.log
log4j.appender.file.layout = org.apache.log4j.PatternLayout
log4j.appender.file.layout.ConversionPattern= [%-5p][%d{yyyy-MM-dd HH:mm:ss}]%m%n

#自定义滚动文件附加器rollFile，表示当日志文件大小到达指定尺寸时将产生一个新的日志文件
log4j.appender.rollFile = org.apache.log4j.RollingFileAppender
log4j.appender.rollFile.File = D:/Java/WorkSpace/myLogs/mylog2.log
log4j.appender.rollFile.MaxFileSize = 10KB
log4j.appender.rollFile.layout = org.apache.log4j.PatternLayout
log4j.appender.rollFile.layout.ConversionPattern= [%-5p][%d{yyyy-MM-dd HH:mm:ss}]%m%n
```

　　3、调用SLF4J的日志方法即可。

* #### 集成Log4j2

　　1、添加依赖

```xml
<!-- slf4j依赖 -->
<dependency>
    <groupId>org.slf4j</groupId>
    <artifactId>slf4j-api</artifactId>
    <version>1.7.12</version>
</dependency>
<!-- slf4j和log4j2的适配器依赖 -->
<dependency>
    <groupId>org.apache.logging.log4j</groupId>
    <artifactId>log4j-slf4j-impl</artifactId>
    <version>2.14.1</version>
</dependency>
<!-- log4j2依赖 -->
<dependency>
    <groupId>org.apache.logging.log4j</groupId>
    <artifactId>log4j-core</artifactId>
    <version>2.14.1</version>
</dependency>
<dependency>
    <groupId>org.apache.logging.log4j</groupId>
    <artifactId>log4j-jcl</artifactId>
    <version>2.14.1</version>
</dependency>
```

　　2、在类路径下创建配置文件`log4j2.xml`

```xml
<?xml version="1.0" encoding="UTF-8"?>

<!--status属性用于设置log4j2自身运行的日志配置，一般为OFF-->
<Configuration status="OFF">
    <!--附加器元素-->
    <Appenders>
        <Console name="console" target="SYSTEM_OUT">
            <PatternLayout pattern="%d{HH:mm:ss.SSS} [%t] %-5level %logger{36} - %msg%n" />
        </Console>

        <!--fileName="log/output.log"表示日志将在项目根目录下的log/output.log文件中输出。
        append 属性用于设置是否以追加方式将日志写入文件中。-->
        <File name="file" fileName="log/output.log" append="true">
            <PatternLayout pattern="%d{HH:mm:ss.SSS} [%t] %-5level %logger{36} - %msg%n" />
        </File>

        <!--filePattern 指定新创建的日志文件的文件名-->
        <RollingFile name="rollingFile" fileName="logs/app.log"
                     filePattern="logs/$${date:yyyy-MM}/app-%d{MM-dd-yyyy}-%i.log.gz">
            <PatternLayout pattern="%d{HH:mm:ss.SSS} [%t] %-5level %logger{36} - %msg%n" />
            <SizeBasedTriggeringPolicy size="1kb" />
        </RollingFile>
    </Appenders>

    <Loggers>
        <Root level="debug">
            <AppenderRef ref="console" />
            <AppenderRef ref="rollingFile" />
        </Root>
    </Loggers>

</Configuration>
```

　　3、调用SLF4J的日志方法即可。

* #### 集成logback

　　1、添加依赖

```xml
<!-- slf4j依赖 -->
<dependency>
    <groupId>org.slf4j</groupId>
    <artifactId>slf4j-api</artifactId>
    <version>1.7.12</version>
</dependency>
<!-- logback依赖 -->
<dependency>
    <groupId>ch.qos.logback</groupId>
    <artifactId>logback-core</artifactId>
    <version>1.1.3</version>
</dependency>
<dependency>
    <groupId>ch.qos.logback</groupId>
    <artifactId>logback-classic</artifactId>
    <version>1.1.3</version>
</dependency>
```

　　2、在类路径下创建配置文件`logback.xml`

```xml
<?xml version="1.0" encoding="UTF-8" ?>

<configuration scan="true" scanPeriod="3 seconds" DEBUG="true">
    <statusListener class="ch.qos.logback.core.status.OnConsoleStatusListener" />
    <appender name="console" class="ch.qos.logback.core.ConsoleAppender">
        <encoder>
            <pattern>%d{HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n</pattern>
        </encoder>
    </appender>
    <appender name="file" class="ch.qos.logback.core.FileAppender">
        <file>file.log</file>
        <append>true</append>
        <encoder>
            <pattern>%-4relative [%thread] %-5level %logger{35} - %msg%n</pattern>
        </encoder>
    </appender>
    <appender name="rollingFile" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>logs/mylog.log</file>
        <rollingPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy">
            <fileNamePattern>mylog-%d{yyyy-MM-dd}.%i.log.zip</fileNamePattern>
            <!-- 每个日志文件大小不超过100MB，在日志文件总大小不超过20GB的情况下保存60天， -->
            <maxFileSize>100MB</maxFileSize>
            <maxHistory>60</maxHistory>
            <totalSizeCap>20GB</totalSizeCap>
        </rollingPolicy>
        <encoder>
            <pattern>%d{HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n</pattern>
        </encoder>
    </appender>
    <root level="debug">
        <appender-ref ref="console" />
        <appender-ref ref="rollingFile" />
    </root>

</configuration>
```

　　3、调用SLF4J的日志方法即可。